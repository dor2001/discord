<!DOCTYPE html>
<html lang="he" dir="rtl">
<head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>מוזיקה • הגדרות</title><script src="https://cdn.tailwindcss.com"></script><script src="/socket.io/socket.io.js"></script></head>
<body class="bg-neutral-900 text-white min-h-screen">
  <div class="flex">
    <aside class="w-64 bg-black/60 p-4 space-y-4 min-h-screen hidden md:block">
      <div class="font-bold text-xl">🎧 Music Panel</div>
      <nav class="space-y-2">
        <a href="/" class="block px-3 py-2 rounded hover:bg-white/10">לוח בקרה</a>
        <a href="/settings" class="block px-3 py-2 rounded hover:bg-white/10 bg-white/10">הגדרות</a>
        <a href="/logout" class="block px-3 py-2 rounded hover:bg-white/10">התנתק</a>
      </nav>
    </aside>
    <main class="flex-1 p-6 space-y-6">
      <section class="rounded-2xl bg-neutral-800 p-4 max-w-3xl">
        <h1 class="text-2xl font-bold mb-4">הגדרות</h1>
        <div class="grid md:grid-cols-2 gap-4">
          <div><label class="block text-sm mb-1 text-neutral-300">Voice Channel ID (ברירת מחדל)</label><input id="vc" class="w-full bg-neutral-900 border border-neutral-700 rounded px-3 py-2"/><p class="text-xs text-neutral-400 mt-1">בשימוש כשאין זיהוי לערוץ קולי של המשתמש (מהווב/פקודות).</p></div>
          <div><label class="block text-sm mb-1 text-neutral-300">Announce Text Channel ID</label><input id="tc" class="w-full bg-neutral-900 border border-neutral-700 rounded px-3 py-2"/><p class="text-xs text-neutral-400 mt-1">היכן לפרסם הודעת "עכשיו מתנגן" עם תור בלייב.</p></div>
          <div class="flex items-center gap-2"><input id="announce" type="checkbox" class="w-5 h-5"/><label for="announce">פרסם הודעת לייב בעת ניגון</label></div>
          <div class="md:col-span-2"><label class="block text-sm mb-1 text-neutral-300">ז׳אנרים מועדפים (מופרדים בפסיק)</label><input id="genres" class="w-full bg-neutral-900 border border-neutral-700 rounded px-3 py-2" placeholder="mizrahi, pop, hiphop"/><p class="text-xs text-neutral-400 mt-1">משפיע על המלצות בשילוב היסטוריית האזנה.</p></div>
        </div>
        <div class="mt-4"><button id="save" class="px-4 py-2 rounded bg-green-500 text-black font-semibold">שמירה</button></div>
      </section>
    </main>
  </div>
  <script>
    const socket = io(); const el = id => document.getElementById(id);
    socket.on('settings', (s)=>{ el('vc').value = s.defaultVoiceChannelId || ''; el('tc').value = s.announceChannelId || ''; el('announce').checked = !!s.announceLive; el('genres').value = (s.preferredGenres||[]).join(', '); });
    document.getElementById('save').onclick = ()=> { const patch = { defaultVoiceChannelId: el('vc').value.trim(), announceChannelId: el('tc').value.trim(), announceLive: el('announce').checked, preferredGenres: el('genres').value.split(',').map(s=>s.trim()).filter(Boolean) }; socket.emit('settings:save', patch); };
    socket.emit('getState');
  </script>
</body></html>
